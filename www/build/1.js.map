{"version":3,"sources":["../../src/pages/live-match/live-match.module.ts","../../src/pages/live-match/live-match.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACH;AAU7C;IAAA;IAAkC,CAAC;IAAtB,mBAAmB;QAR/B,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,kEAAa;aACd;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,kEAAa,CAAC;aACxC;SACF,CAAC;OACW,mBAAmB,CAAG;IAAD,0BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZqB;AAC+C;AACnD;AACS;AAInB;AAEvC;;;;;GAKG;AAOH;IAAmC,iCAAQ;IAQzC,uBACS,OAAsB,EACtB,SAAoB,EACpB,MAAc,EACd,WAAwB,EACxB,WAAuC,EACvC,SAA0B,EAC1B,QAAkB;QAP3B,YASE,kBAAM,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,CAAC,SAIjD;QAZQ,aAAO,GAAP,OAAO,CAAe;QACtB,eAAS,GAAT,SAAS,CAAW;QACpB,YAAM,GAAN,MAAM,CAAQ;QACd,iBAAW,GAAX,WAAW,CAAa;QACxB,iBAAW,GAAX,WAAW,CAA4B;QACvC,eAAS,GAAT,SAAS,CAAiB;QAC1B,cAAQ,GAAR,QAAQ,CAAU;QAV3B,WAAK,GAAG,KAAK,CAAC;QACd,cAAQ,GAAG,KAAK,CAAC;QAYf,uCAAuC;QACvC,uCAAuC;QACvC,KAAI,CAAC,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;;IACpC,CAAC;IAED,oCAAY,GAAZ,UAAa,IAAS;QAAtB,iBAkCC;QAjCC,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC;YACjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAChC,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,GAAG,QAAQ,CAC3C,CAAC;YACF,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,eAAK;gBACxB,IAAI,KAAK,GAAG,KAAK,CAAC;gBAClB,oBAAoB;gBACpB,KAAK,CAAC,OAAO,CAAC,cAAI;oBAChB,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,IAAI,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC;wBAC3B,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;wBAC3B,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC;wBACxB,EAAE,CAAC,CAAC,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;4BAC1B,EAAE,CAAC,CAAC,KAAI,CAAC,WAAW,CAAC,IAAI,IAAI,SAAS,CAAC,CAAC,CAAC;gCACvC,KAAI,CAAC,WAAW,CAAC,IAAI,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;4BAC3C,CAAC;4BAAC,IAAI,CAAC,CAAC;gCACN,EAAE,CAAC,CAAC,KAAI,CAAC,UAAU,EAAE,IAAI,CAAC,KAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;oCAC5C,KAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gCACpB,CAAC;gCAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;oCAC7B,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gCACvB,CAAC;4BACH,CAAC;wBACH,CAAC;wBACD,KAAK,GAAG,IAAI,CAAC;wBACb,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;4BACd,KAAI,CAAC,eAAe,GAAG,IAAI,CAAC;wBAC9B,CAAC;oBACH,CAAC;gBACH,CAAC,CAAC,CAAC;gBACH,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;oBACX,qBAAqB;gBACvB,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAED,sCAAc,GAAd;QACE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC3B,CAAC;IAED,wCAAgB,GAAhB;QACE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;IACnD,CAAC;IAED,sCAAc,GAAd,UAAe,IAAY,EAAE,SAAkB;QAC7C,IAAI,SAAS,GACX,IAAI,IAAI,GAAG;YACT,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;YACL,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,CAAC;QACV,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;YACd,SAAS,GAAG,SAAS,GAAG,CAAC,CAAC;QAC5B,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,SAAS,GAAG,SAAS,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC;QACjD,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,IAAI,GAAG,CAAC,CAAC,CAAC;YAChB,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,GAAG,SAAS,CAAC;QAClB,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,GAAG,SAAS,CAAC;QAClB,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YAC5C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QACpB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACvB,CAAC;QACD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAED,kCAAU,GAAV;QACE,IAAI,UAAU,GACZ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CACpB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,IAAI,EAAE;YACP,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;oBACD,CAAC,CAAC;YACR,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CACpB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,IAAI,EAAE;gBACP,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;oBACD,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;wBACD,CAAC,CAAC,CAAC;QACX,OAAO,CAAC,GAAG,CAAC,aAAa,GAAG,UAAU,CAAC,CAAC;QACxC,MAAM,CAAC,UAAU,CAAC;IACpB,CAAC;IAED,kCAAU,GAAV;QACE,IAAI,OAAO,GACT,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;aACvE,CAAC;YACJ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;iBACvE,CAAC,CAAC;QACP,IAAI,QAAQ,GACV,IAAI,CAAC,UAAU,EAAE;YACjB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;QAC5E,OAAO,CAAC,GAAG,CAAC,gBAAgB,GAAG,QAAQ,CAAC,CAAC;QACzC,MAAM,CAAC,QAAQ,CAAC;IAClB,CAAC;IAED,iCAAS,GAAT;QACE,IAAI,OAAO,GACT,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;aACvE,CAAC;YACJ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;iBACvE,CAAC,CAAC;QACP,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACZ,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,CAAC,CAAC;QAC1D,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,CAAC,CAAC;QAC1D,CAAC;QACD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACnB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACrB,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG,KAAK,CAAC;QAChC,CAAC;QACD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAED,gCAAQ,GAAR;QACE,IAAI,OAAO,GACT,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;aACvE,CAAC;YACJ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;iBACvE,CAAC,CAAC;QACP,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACZ,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,GAAG,CAAC,CAAC;QACZ,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CACpD,CAAC,CAAC,GAAG,CAAC,CAAC;QACZ,CAAC;QACD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YACvB,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACxB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACxB,CAAC;QACD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAED,kCAAU,GAAV;QACE,IAAI,CAAC,WAAW;aACb,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,GAAG,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;aACzE,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC9B,CAAC;IA/LoB;QAApB,yEAAS,CAAC,QAAQ,CAAC;kCAAS,6DAAM;iDAAC;IADzB,aAAa;QAJzB,wEAAS,CAAC;YACT,QAAQ,EAAE,iBAAiB;WACG;SAC/B,CAAC;6EAU+B;YACX,8DAAS;YACZ,2EAAM;YACD,iGAAW;YACX,uEAA0B;YAC5B,iEAAe;YAChB,QAAQ;OAfhB,aAAa,CAiMzB;oEAAD,GAAC;AAAA;SAjMY,aAAa,gB","file":"1.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LiveMatchPage } from './live-match';\n\n@NgModule({\n  declarations: [\n    LiveMatchPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LiveMatchPage),\n  ],\n})\nexport class LiveMatchPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/live-match/live-match.module.ts","import { Component, ViewChild } from \"@angular/core\";\nimport {\n  IonicPage,\n  NavController,\n  NavParams,\n  Events,\n  Platform,\n  AlertController,\n  Navbar\n} from \"ionic-angular\";\nimport { BasePage } from \"../../common/BasePage\";\nimport { AuthService } from \"../../services/auth.service\";\nimport {\n  AfoListObservable,\n  AngularFireOfflineDatabase\n} from \"angularfire2-offline/database\";\n\n/**\n * Generated class for the LiveMatchPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage({\n  name: \"live-match\",\n  segment: \"live-match/:id\"\n})\n@Component({\n  selector: \"page-live-match\",\n  templateUrl: \"live-match.html\"\n})\nexport class LiveMatchPage extends BasePage {\n  @ViewChild(\"navbar\") navBar: Navbar;\n  games: AfoListObservable<any[]>;\n  gameId: String;\n  currentGame: any;\n  pause = false;\n  gameOver = false;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public events: Events,\n    public authService: AuthService,\n    public afoDatabase: AngularFireOfflineDatabase,\n    public alertCtrl: AlertController,\n    public platform: Platform\n  ) {\n    super(navCtrl, authService, alertCtrl, platform);\n    // this.teamA = navParams.get(\"teamA\");\n    // this.teamB = navParams.get(\"teamB\");\n    this.gameId = navParams.get(\"id\");\n  }\n\n  onUserChange(user: any) {\n    if (user != null) {\n      this.games = this.afoDatabase.list(\n        \"/\" + this.authService.user.uid + \"/games\"\n      );\n      this.games.subscribe(items => {\n        var found = false;\n        // items is an array\n        items.forEach(item => {\n          if (item.id == this.gameId) {\n            console.log(\"Item:\", item);\n            this.currentGame = item;\n            if (this.currentGame.live) {\n              if (this.currentGame.sets == undefined) {\n                this.currentGame.sets = [{ a: 0, b: 0 }];\n              } else {\n                if (this.isSetEnded() && !this.isGameOver()) {\n                  this.pause = true;\n                } else if (this.isGameOver()) {\n                  this.gameOver = true;\n                }\n              }\n            }\n            found = true;\n            if (item.live) {\n              this.askBeforeGoBack = true;\n            }\n          }\n        });\n        if (!found) {\n          //TODO: error message\n        }\n      });\n    }\n  }\n\n  ionViewDidLoad() {\n    this.onInit(this.navBar);\n  }\n\n  ionViewWillEnter() {\n    this.events.publish(\"currentPage\", \"live-match\");\n  }\n\n  updateSetValue(team: String, increment: boolean) {\n    var teamValue =\n      team == \"a\"\n        ? this.currentGame.sets[\n            this.currentGame.resultA + this.currentGame.resultB\n          ].a\n        : this.currentGame.sets[\n            this.currentGame.resultA + this.currentGame.resultB\n          ].b;\n    if (increment) {\n      teamValue = teamValue + 1;\n    } else {\n      teamValue = teamValue == 0 ? 0 : teamValue - 1;\n    }\n\n    if (team == \"a\") {\n      this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].a = teamValue;\n    } else {\n      this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].b = teamValue;\n    }\n\n    if (this.isSetEnded() && !this.isGameOver()) {\n      this.pause = true;\n    } else if (this.isGameOver()) {\n      this.gameOver = true;\n    }\n    this.updateGame();\n  }\n\n  isSetEnded() {\n    var isSetEnded =\n      (this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].a >= 25 &&\n        this.currentGame.sets[\n          this.currentGame.resultA + this.currentGame.resultB\n        ].a >=\n          this.currentGame.sets[\n            this.currentGame.resultA + this.currentGame.resultB\n          ].b +\n            2) ||\n      (this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].b >= 25 &&\n        this.currentGame.sets[\n          this.currentGame.resultA + this.currentGame.resultB\n        ].b >=\n          this.currentGame.sets[\n            this.currentGame.resultA + this.currentGame.resultB\n          ].a +\n            2);\n    console.log(\"set ended: \" + isSetEnded);\n    return isSetEnded;\n  }\n\n  isGameOver() {\n    var winnerA =\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .a >=\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .b;\n    var gameOver =\n      this.isSetEnded() &&\n      (winnerA ? this.currentGame.resultA == 2 : this.currentGame.resultB == 2);\n    console.log(\"is game over: \" + gameOver);\n    return gameOver;\n  }\n\n  createSet() {\n    var winnerA =\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .a >=\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .b;\n    if (winnerA) {\n      this.currentGame.resultA = this.currentGame.resultA + 1;\n    } else {\n      this.currentGame.resultB = this.currentGame.resultB + 1;\n    }\n    if (!this.gameOver) {\n      this.currentGame.sets.push({ a: 0, b: 0 });\n      this.pause = false;\n    } else {\n      this.currentGame.live = false;\n    }\n    this.updateGame();\n  }\n\n  rollBack() {\n    var winnerA =\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .a >\n      this.currentGame.sets[this.currentGame.resultA + this.currentGame.resultB]\n        .b;\n    if (winnerA) {\n      this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].a =\n        this.currentGame.sets[\n          this.currentGame.resultA + this.currentGame.resultB\n        ].a - 1;\n    } else {\n      this.currentGame.sets[\n        this.currentGame.resultA + this.currentGame.resultB\n      ].b =\n        this.currentGame.sets[\n          this.currentGame.resultA + this.currentGame.resultB\n        ].b - 1;\n    }\n    if (!this.isSetEnded()) {\n      console.log(\"setEnded\");\n      this.pause = false;\n      this.gameOver = false;\n    }\n    this.updateGame();\n  }\n\n  updateGame() {\n    this.afoDatabase\n      .object(\"/\" + this.authService.user.uid + \"/games/\" + this.currentGame.id)\n      .update(this.currentGame);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/live-match/live-match.ts"],"sourceRoot":""}