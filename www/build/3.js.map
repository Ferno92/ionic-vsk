{"version":3,"sources":["../../src/pages/game-tabs/game-tabs.module.ts","../../src/pages/game-tabs/game-tabs.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { GameTabsPage } from './game-tabs';\n\n@NgModule({\n  declarations: [\n    GameTabsPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(GameTabsPage),\n  ],\n})\nexport class GameTabsPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game-tabs/game-tabs.module.ts","import { Component, ViewChild } from \"@angular/core\";\nimport {\n  IonicPage,\n  NavController,\n  NavParams,\n  Events,\n  Platform,\n  AlertController,\n  Navbar\n} from \"ionic-angular\";\nimport { BasePage } from '../../common/BasePage';\nimport { AuthService } from \"../../services/auth.service\";\nimport { ScreenOrientation } from \"@ionic-native/screen-orientation\";\nimport {\n  AngularFireOfflineDatabase\n} from \"angularfire2-offline/database\";\n\n/**\n * Generated class for the GameTabsPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage({\n  name: \"game-tabs\",\n  segment: \"game-tabs\"\n})\n@Component({\n  selector: 'page-game-tabs',\n  templateUrl: 'game-tabs.html',\n})\nexport class GameTabsPage extends BasePage {\n  @ViewChild(Navbar) navbar: Navbar;\n  scorePage = \"live-match\";\n  formationPage = \"formation\";\n  chatPage = \"chat\";\n  scoreParams: any;\n  rotation = \"phone-landscape\";\n  isLandscape = false;\n  isLocked = false;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams,\n    public authService: AuthService,\n    public alertCtrl: AlertController,\n    public platform: Platform,\n    private screenOrientation: ScreenOrientation,\n    public afoDatabase: AngularFireOfflineDatabase) {\n    super(navCtrl, authService, alertCtrl, platform);\n    this.scoreParams = {\n      id: navParams.get(\"id\"),\n      audienceId: navParams.get(\"audienceId\")\n    }\n  }\n  \n  ionViewDidLoad() {\n    this.initOnScreenOrientationChange();\n    this.onInit(this.navbar);\n  }\n\n  \n  onUserChange(user: any) {\n    console.log(\"on user change live\" + user);\n    if (user != null) {\n      var id = \"\";\n      console.log(\"1, audience: \" + (this.scoreParams.audienceId == \"undefined\"));\n      if (this.scoreParams.audienceId == undefined || this.scoreParams.audienceId == \"undefined\" || this.scoreParams.audienceId == \":audienceId\") {\n        console.log(\"2\");\n        id = this.authService.user.uid;\n        this.retrieveGameInfo(id, false);\n      } else {\n        console.log(\"3\");\n        this.findUserFromAudienceId();\n      }\n    } else {\n      console.log(\"4\");\n      this.findUserFromAudienceId();\n    }\n    console.log(\"5\");\n    this.initOnScreenOrientationChange();\n  }\n\n  findUserFromAudienceId() {\n    var id = \"\";\n    var isAudience = true;\n    var users = this.afoDatabase.list(\"/users\");\n    users.subscribe(userList => {\n      userList.forEach(user => {\n        if (user.audienceId == this.scoreParams.audienceId) {\n          id = user.$key;\n          this.retrieveGameInfo(id, isAudience);\n        }\n      });\n    });\n  }\n\n  retrieveGameInfo(userId: string, isAudience: boolean) {\n    var url = \"/users/\" + userId + \"/games\";\n    console.log(url);\n    var games = this.afoDatabase.list(url);\n    games.subscribe(items => {\n      var found = false;\n      // items is an array\n      items.forEach(item => {\n        if (item.id == this.scoreParams.id) {\n          console.log(\"Item:\", item);\n          found = true;\n          if (item.live && !isAudience) {\n            this.askBeforeGoBack = true;\n          }\n        }\n      });\n      if (!found) {\n        //TODO: error message\n      }\n    });\n  }\n  \n\n  rotate() {\n    // console.log(this.screenOrientation.type);\n    if (\n      this.screenOrientation.type !=\n        this.screenOrientation.ORIENTATIONS.LANDSCAPE &&\n      this.screenOrientation.type !=\n        this.screenOrientation.ORIENTATIONS.LANDSCAPE_PRIMARY &&\n      this.screenOrientation.type !=\n        this.screenOrientation.ORIENTATIONS.LANDSCAPE_SECONDARY\n    ) {\n      document.body.webkitRequestFullscreen();\n      if (!this.isLocked) {\n        this.screenOrientation.lock(\n          this.screenOrientation.ORIENTATIONS.LANDSCAPE\n        );\n        this.isLocked = true;\n      }\n      this.isLandscape = true;\n      this.rotation = \"phone-portrait\";\n    } else {\n      if (!this.isLocked) {\n        this.screenOrientation.lock(\n          this.screenOrientation.ORIENTATIONS.PORTRAIT\n        );\n        this.isLocked = true;\n      }\n      var self = this;\n      setTimeout(function() {\n        if (this.isLocked) {\n          self.screenOrientation.unlock();\n          self.isLocked = false;\n        }\n        document.webkitExitFullscreen();\n        self.isLandscape = false;\n        self.rotation = \"phone-landscape\";\n      }, 500);\n    }\n  }\n\n  initOnScreenOrientationChange() {\n    this.screenOrientation.onChange().subscribe(type => {\n      console.log(\"on change: \" + type);\n      if (\n        this.screenOrientation.type !=\n          this.screenOrientation.ORIENTATIONS.LANDSCAPE &&\n        this.screenOrientation.type !=\n          this.screenOrientation.ORIENTATIONS.LANDSCAPE_PRIMARY &&\n        this.screenOrientation.type !=\n          this.screenOrientation.ORIENTATIONS.LANDSCAPE_SECONDARY\n      ) {\n        this.isLandscape = false;\n        this.rotation = \"phone-landscape\";\n      } else {\n        this.isLandscape = true;\n        this.rotation = \"phone-portrait\";\n      }\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/game-tabs/game-tabs.ts"],"sourceRoot":""}